<!DOCTYPE html>
<html>
<head>
  <title>Data visualization with ggplot2</title>
  <meta charset="utf-8">
  <meta name="description" content="Data visualization with ggplot2">
  <meta name="author" content="Data Carpentry contributors">
  <meta name="generator" content="slidify" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <link rel="stylesheet" href="http://slidifylibraries2.googlecode.com/git/inst/libraries/frameworks/io2012/css/default.css" media="all" >
  <link rel="stylesheet" href="http://slidifylibraries2.googlecode.com/git/inst/libraries/frameworks/io2012/css/phone.css" 
    media="only screen and (max-device-width: 480px)" >
  <link rel="stylesheet" href="http://slidifylibraries2.googlecode.com/git/inst/libraries/frameworks/io2012/css/slidify.css" >
  <link rel="stylesheet" href="http://slidifylibraries2.googlecode.com/git/inst/libraries/highlighters/highlight.js/css/tomorrow.css" />
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->  
  
  <!-- Grab CDN jQuery, fall back to local if offline -->
  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.min.js"></script>
  <script>window.jQuery || document.write('<script src="http://slidifylibraries2.googlecode.com/git/inst/libraries/widgets/quiz/js/jquery.js"><\/script>')</script> 
  <script data-main="http://slidifylibraries2.googlecode.com/git/inst/libraries/frameworks/io2012/js/slides" 
    src="http://slidifylibraries2.googlecode.com/git/inst/libraries/frameworks/io2012/js/require-1.0.8.min.js">
  </script>
  
  

</head>
<body style="opacity: 0">
  <slides class="layout-widescreen">
    
    <!-- LOGO SLIDE -->
        <slide class="title-slide segue nobackground">
  <hgroup class="auto-fadein">
    <h1>Data visualization with ggplot2</h1>
    <h2></h2>
    <p>Data Carpentry contributors<br/></p>
  </hgroup>
  <article></article>  
</slide>
    

    <!-- SLIDES -->
    <slide class="" id="slide-1" style="background:;">
  <article data-timings="">
    
  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-2" style="background:;">
  <article data-timings="">
    <blockquote>
<h3>Learning Objectives</h3>

<ul>
<li>Create simple scatterplots, histograms, and boxplots in R.</li>
<li>Set universal plot settings.</li>
<li>Understand and apply faceting in ggplot.</li>
<li>Modify the aesthetics of an existing ggplot plot (including axis labels and color).</li>
<li>Build complex and customized plots from data in a data frame.</li>
</ul>

  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-3" style="background:;">
  <article data-timings="">
    <p>We start by loading the required packages. <strong><code>ggplot2</code>** is included in the **<code>tidyverse</code></strong> package.</p>

<pre><code class="r">library(ggplot2)
library(tidyverse)
</code></pre>

<p>If not still in the workspace, load the data we saved in the previous lesson.</p>

<pre><code class="r">metadata &lt;- read.csv(&#39;data/metadata.csv&#39;, header = TRUE, sep = &quot;\t&quot;)
</code></pre>

<h1>Basic plots in R</h1>

<p>The mathematician Richard Hamming once said, &quot;The purpose of computing is insight, not numbers&quot;, and the best way to develop insight is often to visualize data. Visualization deserves an entire lecture (or course) of its own, but we can explore a few features of R&#39;s plotting packages.</p>

<p>When we are working with large sets of numbers it can be useful to display that information graphically. R has a number of built-in tools for basic graph types such as hisotgrams, scatter plots, bar charts, boxplots and much <a href="http://www.statmethods.net/graphs/">more</a>. We&#39;ll test a few of these out here on the <code>Age</code> vector from our metadata.</p>

<pre><code class="r">metadata_age &lt;- metadata$Age
</code></pre>

<pre><code>#&gt; Error in eval(expr, envir, enclos): object &#39;metadata&#39; not found
</code></pre>

<h2>Scatterplot</h2>

<p>Let&#39;s start with a <strong>scatterplot</strong>. A scatter plot provides a graphical view of the relationship between two sets of numbers. We don&#39;t have a variable in our metadata that is a continous variable, so there is nothing to plot it against but we can plot the values against their index values just to demonstrate the function.</p>

<pre><code class="r">plot(metadata_age)
</code></pre>

<pre><code>#&gt; Error in plot(metadata_age): object &#39;metadata_age&#39; not found
</code></pre>

<p>Each point represents a clone and the value on the x-axis is the clone index in the file, where the values on the y-axis correspond to the genome size for the clone. For any plot you can customize many features of your graphs (fonts, colors, axes, titles) through <a href="http://www.statmethods.net/advgraphs/parameters.html">graphic options</a>
For example, we can change the shape of the data point using <code>pch</code>.</p>

<pre><code class="r">plot(metadata_age, pch=8)
</code></pre>

<pre><code>#&gt; Error in plot(metadata_age, pch = 8): object &#39;metadata_age&#39; not found
</code></pre>

<p>We can add a title to the plot by assigning a string to <code>main</code>:</p>

<pre><code class="r">plot(metadata_age, pch=8, main=&quot;Scatter plot of age distribution&quot;)
</code></pre>

<pre><code>#&gt; Error in plot(metadata_age, pch = 8, main = &quot;Scatter plot of age distribution&quot;): object &#39;metadata_age&#39; not found
</code></pre>

<h2>Histogram</h2>

<p>Another way to visualize the distribution of ages is to use a histogram, we can do this buy using the <code>hist</code> function:</p>

<pre><code class="r">hist(metadata_age)
</code></pre>

<pre><code>#&gt; Error in hist(metadata_age): object &#39;metadata_age&#39; not found
</code></pre>

<h2>Boxplot</h2>

<p>Using additional information from our metadata, we can use plots to compare values between the different body mass indices (BMIs) using a <strong>boxplot</strong>. A boxplot provides a graphical view of the median, quartiles, maximum, and minimum of a data set. </p>

<pre><code class="r"># Boxplot
boxplot(metadata_age ~ BodyMassIndex, metadata)
</code></pre>

<pre><code>#&gt; Error in eval(expr, envir, enclos): object &#39;metadata&#39; not found
</code></pre>

<p>Similar to the scatterplots above, we can pass in arguments to add in extras like plot title, axis labels and colors.</p>

<pre><code class="r">boxplot(metadata_age ~ BodyMassIndex, metadata,  col=c(&quot;pink&quot;,&quot;purple&quot;, &quot;darkgrey&quot;),
        main=&quot;Average expression differences between celltypes&quot;, ylab=&quot;Expression&quot;)
</code></pre>

<pre><code>#&gt; Error in eval(expr, envir, enclos): object &#39;metadata&#39; not found
</code></pre>

<h2>Advanced figures (<code>ggplot2</code>)</h2>

<p>More recently, R users have moved away from base graphic options and towards a plotting package called <a href="http://docs.ggplot2.org/"><code>ggplot2</code></a> that adds a lot of functionality to the basic plots seen above. The syntax takes some getting used to but it&#39;s extremely powerful and flexible. We can start by re-creating some of the above plots but using ggplot functions to get a feel for the syntax.</p>

<p><code>ggplot2</code> is best used on data in the <code>data.frame</code> form, so we will will work with <code>metadata</code> for the following figures. Let&#39;s start by loading the <code>ggplot2</code> library.</p>

<pre><code class="r">library(ggplot2)
</code></pre>

<p>The <code>ggplot()</code> function is used to initialize the basic graph structure, then we add to it. The basic idea is that you specify different parts of the plot, and add them together using the <code>+</code> operator. This helps in creating
publication quality plots with minimal amounts of adjustments and tweaking.</p>

<p>ggplot likes data in the &#39;long&#39; format: i.e., a column for every dimension,
and a row for every observation. Well structured data will save you lots of time
when making figures with ggplot.</p>

<p>To build a ggplot, we need to:</p>

<ul>
<li>use the <code>ggplot()</code> function and bind the plot to a specific data frame using the<br>
  <code>data</code> argument</li>
</ul>

<pre><code class="r">ggplot(data = metadata)
</code></pre>

<p>Geometric objects are the actual marks we put on a plot. Examples include:</p>

<ul>
<li>points (<code>geom_point</code>, for scatter plots, dot plots, etc)</li>
<li>lines (<code>geom_line</code>, for time series, trend lines, etc)</li>
<li>boxplot (<code>geom_boxplot</code>, for, well, boxplots!)</li>
</ul>

<p>A plot <strong>must have at least one geom</strong>; there is no upper limit. You can add a geom to a plot using the + operator</p>

<pre><code class="r">ggplot(metadata) +
  geom_point() # note what happens here
</code></pre>

<p>Each type of geom usually has a <strong>required set of aesthetics</strong> to be set, and usually accepts only a subset of all aesthetics --refer to the geom help pages to see what mappings each geom accepts. Aesthetic mappings are set with the aes() function. Examples include:</p>

<ul>
<li>position (i.e., on the x and y axes)</li>
<li>color (&quot;outside&quot; color)</li>
<li>fill (&quot;inside&quot; color) shape (of points)</li>
<li>linetype</li>
<li>size</li>
</ul>

<p>To start, we will add position for the x- and y-axis since <code>geom_point</code> requires mappings for x and y, all others are optional.</p>

<pre><code class="r">ggplot(data = metadata) +
  geom_point(aes(x = Age, y= BodyMassIndex))
</code></pre>

<pre><code>#&gt; Error in ggplot(data = metadata): object &#39;metadata&#39; not found
</code></pre>

<p>The same figure will be generated if the aesthetics are place in the ggplot() function:</p>

<pre><code class="r">ggplot(data = metadata, aes(x = Age, y= BodyMassIndex)) +
  geom_point()
</code></pre>

<pre><code>#&gt; Error in ggplot(data = metadata, aes(x = Age, y = BodyMassIndex)): object &#39;metadata&#39; not found
</code></pre>

<p>If labels on the x-axis are hard to read, you can add an additional theme layer. The ggplot2 <code>theme</code> system handles non-data plot elements such as:</p>

<ul>
<li>Axis labels</li>
<li>Plot background</li>
<li>Facet label backround</li>
<li>Legend appearance</li>
</ul>

<p>There are built-in themes we can use, or we can adjust specific elements. For demonstration purposes, let&#39;s change the x-axis labels to be plotted on a 45 degree angle with a small horizontal shift. We will also add some additional aesthetics by mapping them to other variables in our dataframe. <em>For example, the color of the points will reflect the number of generations and the shape will reflect citrate mutant status.</em> The size of the points can be adjusted within the <code>geom_point</code> but does not need to be included in <code>aes()</code> since the value is not mapping to a variable.</p>

<pre><code class="r">ggplot(data = metadata, aes(x = Age, y= BodyMassIndex, color = BodySuperSite, shape = Sex)) +
  geom_point(size = rel(3.0)) +
  theme(axis.text.x = element_text(angle=45, hjust=1))
</code></pre>

<pre><code>#&gt; Error in ggplot(data = metadata, aes(x = Age, y = BodyMassIndex, color = BodySuperSite, : object &#39;metadata&#39; not found
</code></pre>

<h2>Histogram</h2>

<p>To plot a histogram we require another geometric object <code>geom_bar</code>, which requires a statistical transformation. Some plot types (such as scatterplots) do not require transformations, each point is plotted at x and y coordinates equal to the original value. Other plots, such as boxplots, histograms, prediction lines etc. need to be transformed, and usually has a default statistic that can be changed via the <code>stat_bin</code> argument. </p>

<pre><code class="r">ggplot(data = metadata, aes(x = Age)) +
  geom_bar()
</code></pre>

<p>Try plotting with the default value and compare it to the plot using the binwidth values. How do they differ?</p>

<pre><code class="r">ggplot(data = metadata, aes(x = Age)) +
  geom_bar(stat = &quot;bin&quot;, binwidth=0.05)
</code></pre>

<pre><code>#&gt; Error in ggplot(data = metadata, aes(x = Age)): object &#39;metadata&#39; not found
</code></pre>

<h2>Boxplot</h2>

<p>Now that we have all the required information, let&#39;s try plotting a boxplot similar to what we had done using the base plot functions at the start of this lesson. We can add some additional layers to include a plot title and change the axis labels. Explore the code below and all the different layers that we have added to understand what each layer contributes to the final graphic.</p>

<pre><code class="r">ggplot(data = metadata, aes(x = Sex, y = BodyMassIndex)) +
  geom_boxplot() +
  ggtitle(&#39;Distribution of body mass index by sex&#39;) +
  xlab(&#39;Gender&#39;) +
  ylab(&#39;Body mass index&#39;) +
  theme(panel.grid.major = element_line(size = .5, color = &quot;grey&quot;),
          axis.text.x = element_text(angle=45, hjust=1),
          axis.title = element_text(size = rel(1.5)),
          axis.text = element_text(size = rel(1.25)))
</code></pre>

<pre><code>#&gt; Error in ggplot(data = metadata, aes(x = Sex, y = BodyMassIndex)): object &#39;metadata&#39; not found
</code></pre>

<p>By adding points to boxplot, we can have a better idea of the number of
measurements and of their distribution:</p>

<pre><code class="r">ggplot(data = metadata, aes(x = Sex, y = BodyMassIndex)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.3, color = &quot;tomato&quot;) +
  theme_bw() +
  ggtitle(&#39;Distribution of body mass index by sex&#39;) +
  xlab(&#39;Gender&#39;) +
  ylab(&#39;Body mass index&#39;) +
  theme(panel.grid.major = element_line(size = .5, color = &quot;grey&quot;),
          axis.text.x = element_text(angle=45, hjust=1),
          axis.title = element_text(size = rel(1.5)),
          axis.text = element_text(size = rel(1.25)))
</code></pre>

<pre><code>#&gt; Error in ggplot(data = metadata, aes(x = Sex, y = BodyMassIndex)): object &#39;metadata&#39; not found
</code></pre>

<p>Notes:</p>

<ul>
<li>The <code>+</code> sign used to add layers must be placed at the end of each line containing
a layer. If, instead, the <code>+</code> sign is added in the line before the other layer,
<strong><code>ggplot2</code></strong> will not add the new layer and will return an error message.</li>
</ul>

<h2><strong><code>ggplot2</code></strong> themes</h2>

<p>In addition to <code>theme_bw()</code>, which changes the plot background to white, **<code>ggplot2</code>**
comes with several other themes which can be useful to quickly change the look
of your visualization. The complete list of themes is available
at <a href="http://docs.ggplot2.org/current/ggtheme.html">http://docs.ggplot2.org/current/ggtheme.html</a>. <code>theme_minimal()</code> and
<code>theme_light()</code> are popular, and <code>theme_void()</code> can be useful as a starting
point to create a new hand-crafted theme.</p>

<p>The
<a href="https://cran.r-project.org/web/packages/ggthemes/vignettes/ggthemes.html">ggthemes</a> package
provides a wide variety of options (including an Excel 2003 theme).
The <a href="https://www.ggplot2-exts.org"><strong><code>ggplot2</code></strong> extensions website</a> provides a list
of packages that extend the capabilities of <strong><code>ggplot2</code></strong>, including additional
themes.</p>

<h2>Customization</h2>

<p>Take a look at the <a href="https://www.rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf"><strong><code>ggplot2</code></strong> cheat sheet</a>, for ideas on how you can improve plots.</p>

<h1>Writing figures to a file</h1>

<p>There are two ways in which figures and plots can be output to a file (rather than simply displaying on screen). The first (and easiest) is to export directly from the RStudio &#39;Plots&#39; panel, by clicking on <code>Export</code> when the image is plotted. This will give you the option of <code>png</code> or <code>pdf</code> and selecting the directory to which you wish to save it to. </p>

<p>The second option is to use R functions in the console, allowing you the flexibility to specify parameters to dictate the size and resolution of the output image. Some of the more popular formats include <code>pdf()</code>, <code>png()</code>, which are functions that initialize a plot that will be written directly to a file in the <code>pdf</code> or <code>png</code> format, respectively. Within the function you will need to specify a name for your image in quotes and the width and height. Specifying the width and height is optional, but can be very useful if you are using the figure in a paper or presentation and need it to have a particular resolution. Note that the default units for image dimensions are either pixels (for png) or inches (for pdf). To save a plot to a file you need to:</p>

<ol>
<li>Initialize the plot using the function that corresponds to the type of file you want to make: <code>pdf(&quot;filename&quot;)</code></li>
<li>Write the code that makes the plot.</li>
<li>Close the connection to the new file (with your plot) using <code>dev.off()</code>.</li>
</ol>

<pre><code class="r"># Let&#39;s make a new directory where figures can be stored:

dir.create(&quot;figures&quot;)

pdf(&quot;figures/boxplot.pdf&quot;)

ggplot(data = metadata, aes(x = Sex, y = BodyMassIndex)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.3, color = &quot;tomato&quot;) +
  theme_bw() +
  ggtitle(&#39;Distribution of body mass index by sex&#39;) +
  xlab(&#39;Gender&#39;) +
  ylab(&#39;Body mass index&#39;) +
  theme(panel.grid.major = element_line(size = .5, color = &quot;grey&quot;),
          axis.text.x = element_text(angle=45, hjust=1),
          axis.title = element_text(size = rel(1.5)),
          axis.text = element_text(size = rel(1.25)))

dev.off()
</code></pre>

<h2>Resources:</h2>

<p>We have only scratched the surface here. To learn more, see the <a href="http://docs.ggplot2.org/">ggplot2 reference site</a>, and Winston Chang&#39;s excellent <a href="http://wiki.stdout.org/rcookbook/Graphs/">Cookbook for R</a> site. Though slightly out of date, <a href="http://www.amazon.com/ggplot2-Elegant-Graphics-Data-Analysis/dp/0387981403">ggplot2: Elegant Graphics for Data Anaysis</a> is still the definative book on this subject. Much of the material here was adpapted from <a href="http://tutorials.iq.harvard.edu/R/Rgraphics/Rgraphics.html">Introduction to R graphics with ggplot2 Tutorial at IQSS</a>.</p>

<p style="text-align: right; font-size: small;">Page build on: 2017-10-10 09:43:28</p>

  </article>
  <!-- Presenter Notes -->
</slide>

    <slide class="backdrop"></slide>
  </slides>
  <div class="pagination pagination-small" id='io2012-ptoc' style="display:none;">
    <ul>
      <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=1 title='NA'>
         1
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=2 title='NA'>
         2
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=3 title='NA'>
         3
      </a>
    </li>
  </ul>
  </div>  <!--[if IE]>
    <script 
      src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js">  
    </script>
    <script>CFInstall.check({mode: 'overlay'});</script>
  <![endif]-->
</body>
  <!-- Load Javascripts for Widgets -->
  
  <!-- LOAD HIGHLIGHTER JS FILES -->
  <script src="http://slidifylibraries2.googlecode.com/git/inst/libraries/highlighters/highlight.js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <!-- DONE LOADING HIGHLIGHTER JS FILES -->
   
  </html>